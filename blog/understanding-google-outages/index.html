<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width, shrink-to-fit=no, user-scalable=1, viewport-fit=cover"/><title>Understanding Google Outages on December 14, 2020</title><meta name="title" content="Understanding Google Outages on December 14, 2020"/><meta name="description" content="An overview of two major outages happened on 14th December, 2020. This is not an authoritative analysis but can be considered as notes regarding the aforesaid incidents."/><meta name="og:type" content="article"/><meta name="og:url" content="/blog/understanding-google-outages"/><meta name="og:title" content="Understanding Google Outages on December 14, 2020"/><meta name="og:description" content="An overview of two major outages happened on 14th December, 2020. This is not an authoritative analysis but can be considered as notes regarding the aforesaid incidents."/><meta name="og:image" content="https://krishnamohan.dev/banners/06.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:url" content="/blog/understanding-google-outages"/><meta name="twitter:title" content="Understanding Google Outages on December 14, 2020"/><meta name="twitter:description" content="An overview of two major outages happened on 14th December, 2020. This is not an authoritative analysis but can be considered as notes regarding the aforesaid incidents."/><meta name="twitter:image" content="https://krishnamohan.dev/banners/06.png"/><meta name="twitter:site" content="@krishnaanaril"/><meta name="twitter:creator" content="@krishnaanaril"/><meta name="keywords" content="google, outage"/><meta name="og:article:published_time" content="2021-01-06T00:00:00.000Z"/><meta name="og:article:modified_time" content="2020-09-02T00:00:00.000Z"/><meta name="og:article:author" content="Krishna Mohan A M"/><meta name="og:article:section" content="tech"/><meta name="og:article:tag" content="google, outage"/><meta name="next-head-count" content="23"/><link href="https://unpkg.com/prism-themes@1.6.0/themes/prism-shades-of-purple.css" rel="stylesheet"/><link rel="preload" href="/_next/static/css/f539d5c534587250.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f539d5c534587250.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-3653f441c4a2aa8a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e1cb0d25eaeaa056.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bid%5D-924e5c64dd31e5a2.js" defer=""></script><script src="/_next/static/e0fszqdCnSRQTw8Y4iqrX/_buildManifest.js" defer=""></script><script src="/_next/static/e0fszqdCnSRQTw8Y4iqrX/_ssgManifest.js" defer=""></script></head><body class="bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50 px-5 lg:px-0"><div id="__next"><div><nav class="sticky top-0 bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50 bg-opacity-50 dark:bg-opacity-50 backdrop-blur-lg"><section class="hidden lg:flex flex-row justify-center"><nav><ul class="lg:text-xl lg:flex lg:flex-row"><li class=""><a class="block p-4 cursor-pointer" href="/">Home</a></li><li class="border-b-2 border-gray-700 dark:border-gray-300"><a class="block p-4 cursor-pointer" href="/blogs/">Blog</a></li><li class=""><a class="block p-4 cursor-pointer" href="/projects/">Projects</a></li><li class=""><a class="block p-4 cursor-pointer" href="/about/">About</a></li></ul></nav></section><div class="lg:hidden mr-4 py-4 right-0"><button class="p-2" aria-label="view menu items"><svg class="fill-gray-800 dark:fill-gray-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black" width="24px" height="24px"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button></div></nav><div style="display:none" class="fixed top-0 left-0 bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50 bg-opacity-50 dark:bg-opacity-50 backdrop-blur-lg block h-screen lg:hidden p-2 w-screen z-1"><div class="bg-gray-100 bg-opacity-100 m-5 p-5 rounded-lg shadow-xl dark:bg-gray-600 dark:text-gray-50"><div class="flex flex-row justify-end"><button class="dark:text-gray-50" aria-label="close menu items"><svg class="fill-current" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button></div><ul class="list-none"><li class=""><a class="block p-4 cursor-pointer" href="/">Home</a></li><li class="border-b-2 border-gray-700 dark:border-gray-300"><a class="block p-4 cursor-pointer" href="/blogs/">Blog</a></li><li class=""><a class="block p-4 cursor-pointer" href="/projects/">Projects</a></li><li class=""><a class="block p-4 cursor-pointer" href="/about/">About</a></li></ul></div></div><div class="min-h-screen"><article class="bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50"><div><div aria-label="Blog tags/keywords" class="pt-8 flex flex-row justify-center"><div class="bg-gray-300 dark:bg-gray-700 border border-gray-400 ml-2 mr-2 pb-2 pl-4 pr-4 pt-2 text-sm align-baseline rounded-full">google</div><div class="bg-gray-300 dark:bg-gray-700 border border-gray-400 ml-2 mr-2 pb-2 pl-4 pr-4 pt-2 text-sm align-baseline rounded-full">outage</div></div><div class="max-w-screen-lg mx-auto"><h1 class="text-5xl font-bold pt-5 pb-5 text-center">Understanding Google Outages on December 14, 2020</h1></div><div class="flex flex-row justify-center m-5 max-w-screen-sm mx-auto"><time class="text-center text-xl">6 January 2021</time></div></div><div class="prose dark:prose-invert lg:prose-xl md:prose-lg max-w-screen-md mx-auto"><p>On that fateful day I was playing around with Youtube API to find a custom algorithm to avoid the default recommendations. All of sudden server errors started popping up for my API requests and for a moment I thought that I broke it. To verify this I logged in to Twitter and it was already trending there.</p>
<p>There were multiple incidents on that day, but the most important were the Google cloud and Gmail outages.</p>
<h2>Gmail Outage</h2>
<p>For a period of 6 hours on that day, the service responsible for handling incoming SMTP connections incorrectly responded with an error (<a href="https://docs.microsoft.com/en-us/exchange/mail-flow-best-practices/non-delivery-reports-in-exchange-online/fix-error-code-550-5-1-1-through-5-1-20-in-exchange-online">hard bounce</a>) to emails being sent to “@gmail.com” users. The error message indicated that the email address did not exist and as a result, the impacted emails were never delivered.</p>
<p>Email delivery to other email addresses on Google-hosted domains were not affected by this issue and continued to function correctly. SMTP clients conforming to email standards treat error code 550 as a permanent delivery error and do not attempt to resend the email. In response to a permanent delivery error, intermediate SMTP relays send a bounce email back to the original sender, informing them of the delivery error.</p>
<h3>Root Cause</h3>
<p>Google's SMPT inbound service has a configuration system to update flags and service options while deployed in production and ‘@gmail.com’ domain name is specified as one of the configuration options. During an ongoing migration, a configuration change shifted formatting behavior and provided and invalid domain name instead of “@gmail.com”. Due to this service incorrectly transformed lookups of certain email addresses ending in “@gmail.com” into non-existent email addresses resulting in 550 error code.</p>
<h3>Remediation &#x26; Prevention</h3>
<p>Upon identifying the root cause, engineering team reverted the code change which resolved the immediate issue. But when they again deployed the same configuration system the next day a similar issue occurred. Formatting error related to “@gmail.com” was identified in the internal logs and they have to again revert it.</p>
<p>As per the official statement they’ll be taking necessary actions to guard against the issue recurring and to reduce the impact of similar events.
Impact on Other business</p>
<p>Most impacted business are the email marketing platforms. Some of them even reported a peak of <a href="https://news.ycombinator.com/item?id=25437340">90% bounce</a> for almost 24 hours. Since the error code was 550, the email delivery services might’ve started automatically removing, or at least stopping delivery to, a set of email addresses. But on the brighter side, since it’s a known time frame, domain and error response, they can cleanly remove the suppression lists. An error code of 4xx (temporary error) might’ve reduced the impact and I’m not aware of any known side effects for this.</p>
<h2>Google Cloud Outage</h2>
<p>For a period of 47 minutes on the same day, Google services that required Google OAuth access were unavailable. Cloud service accounts used by GCP workloads were not impacted and continued to function</p>
<h3>Root cause</h3>
<p>Google uses an evolving suite of automation tools to manage the quota of various resources allocated for services. As part of an ongoing migration of the User ID Service to a new quota system, a change was made in October to register the User ID Service with the new quota system, but parts of the previous quota system were left in place which incorrectly reported the usage for the User ID Service as 0. An existing grace period on enforcing quota restrictions delayed the impact, which eventually expired, triggering automated quota systems to decrease the quota allowed for the User ID service and triggering this incident. Existing safety checks exist to prevent many unintended quota changes, but at the time they did not cover the scenario of zero reported load for a single service:</p>
<ul>
<li>Quota changes to large number of users, since only a single group was the target of the change,</li>
<li>Lowering quota below usage, since the reported usage was inaccurately being reported as zero,</li>
<li>Excessive quota reduction to storage systems, since no alert fired during the grace period,</li>
<li>Low quota, since the difference between usage and quota exceeded the protection limit.</li>
</ul>
<p>As a result, the quota for the account database was reduced, which prevented the <a href="(https://en.wikipedia.org/wiki/Paxos_(computer_science))">Paxos leader</a> from writing. Shortly after, the majority of read operations became outdated which resulted in errors on authentication lookups.</p>
<h3>Remediation &#x26; Prevention</h3>
<p>Once the root cause and potential fix were identified, engineers disabled the quota enforcement in one data canter. This quickly improved the situation and later the same mitigation was applied to all data-centres. As per the official statement they’ll be taking necessary actions to guard against the issue recurring and to reduce the impact of similar events.</p>
<h3>Impact on business</h3>
<p>Almost all google services were impacted by this outage. Most services recovered automatically within a short period of time after the main issue ended, but some services like Cloud Console, Google BigQuery and  K8s Engine had unique and lingering impact.</p>
<h2>References:</h2>
<ol>
<li>https://static.googleusercontent.com/media/www.google.com/en//appsstatus/ir/4et50yp2ckm8otv.pdf</li>
<li>https://status.cloud.google.com/incident/zall/20013</li>
</ol>
</div></article></div><footer class="flex flex-col bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50"><div class="mt-10"><ul class="flex flex-row justify-between max-w-sm mx-auto pl-4 pr-4"><li class="hover:text-gray-600 dark:hover:text-gray-100"><a href="https://twitter.com/KrishnaAnaril">Twitter</a></li><li><a href="https://krishnamohan.dev/sitemap.xml">Sitemap</a></li><li><a href="https://krishnamohan.dev/rss.xml">RSS</a></li><li><a href="mailto:krishnamohan.a.m@gmail.com">Contact</a></li></ul></div><div class="mx-auto p-5 text-sm"><p>© 2021-present <a class="font-bold" href="https://krishnamohan.dev/">Krishna Mohan A M</a>. All Rights Reserved.</p></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"understanding-google-outages","meta":{"title":"Understanding Google Outages on December 14, 2020","description":"An overview of two major outages happened on 14th December, 2020. This is not an authoritative analysis but can be considered as notes regarding the aforesaid incidents.","published":true,"publishedAt":"2021-01-06T00:00:00.000Z","updatedAt":"2020-09-02T00:00:00.000Z","category":"tech","image":"banners/06","keywords":["google","outage"],"authors":["Krishna Mohan A M"]},"content":"\u003cp\u003eOn that fateful day I was playing around with Youtube API to find a custom algorithm to avoid the default recommendations. All of sudden server errors started popping up for my API requests and for a moment I thought that I broke it. To verify this I logged in to Twitter and it was already trending there.\u003c/p\u003e\n\u003cp\u003eThere were multiple incidents on that day, but the most important were the Google cloud and Gmail outages.\u003c/p\u003e\n\u003ch2\u003eGmail Outage\u003c/h2\u003e\n\u003cp\u003eFor a period of 6 hours on that day, the service responsible for handling incoming SMTP connections incorrectly responded with an error (\u003ca href=\"https://docs.microsoft.com/en-us/exchange/mail-flow-best-practices/non-delivery-reports-in-exchange-online/fix-error-code-550-5-1-1-through-5-1-20-in-exchange-online\"\u003ehard bounce\u003c/a\u003e) to emails being sent to “@gmail.com” users. The error message indicated that the email address did not exist and as a result, the impacted emails were never delivered.\u003c/p\u003e\n\u003cp\u003eEmail delivery to other email addresses on Google-hosted domains were not affected by this issue and continued to function correctly. SMTP clients conforming to email standards treat error code 550 as a permanent delivery error and do not attempt to resend the email. In response to a permanent delivery error, intermediate SMTP relays send a bounce email back to the original sender, informing them of the delivery error.\u003c/p\u003e\n\u003ch3\u003eRoot Cause\u003c/h3\u003e\n\u003cp\u003eGoogle's SMPT inbound service has a configuration system to update flags and service options while deployed in production and ‘@gmail.com’ domain name is specified as one of the configuration options. During an ongoing migration, a configuration change shifted formatting behavior and provided and invalid domain name instead of “@gmail.com”. Due to this service incorrectly transformed lookups of certain email addresses ending in “@gmail.com” into non-existent email addresses resulting in 550 error code.\u003c/p\u003e\n\u003ch3\u003eRemediation \u0026#x26; Prevention\u003c/h3\u003e\n\u003cp\u003eUpon identifying the root cause, engineering team reverted the code change which resolved the immediate issue. But when they again deployed the same configuration system the next day a similar issue occurred. Formatting error related to “@gmail.com” was identified in the internal logs and they have to again revert it.\u003c/p\u003e\n\u003cp\u003eAs per the official statement they’ll be taking necessary actions to guard against the issue recurring and to reduce the impact of similar events.\r\nImpact on Other business\u003c/p\u003e\n\u003cp\u003eMost impacted business are the email marketing platforms. Some of them even reported a peak of \u003ca href=\"https://news.ycombinator.com/item?id=25437340\"\u003e90% bounce\u003c/a\u003e for almost 24 hours. Since the error code was 550, the email delivery services might’ve started automatically removing, or at least stopping delivery to, a set of email addresses. But on the brighter side, since it’s a known time frame, domain and error response, they can cleanly remove the suppression lists. An error code of 4xx (temporary error) might’ve reduced the impact and I’m not aware of any known side effects for this.\u003c/p\u003e\n\u003ch2\u003eGoogle Cloud Outage\u003c/h2\u003e\n\u003cp\u003eFor a period of 47 minutes on the same day, Google services that required Google OAuth access were unavailable. Cloud service accounts used by GCP workloads were not impacted and continued to function\u003c/p\u003e\n\u003ch3\u003eRoot cause\u003c/h3\u003e\n\u003cp\u003eGoogle uses an evolving suite of automation tools to manage the quota of various resources allocated for services. As part of an ongoing migration of the User ID Service to a new quota system, a change was made in October to register the User ID Service with the new quota system, but parts of the previous quota system were left in place which incorrectly reported the usage for the User ID Service as 0. An existing grace period on enforcing quota restrictions delayed the impact, which eventually expired, triggering automated quota systems to decrease the quota allowed for the User ID service and triggering this incident. Existing safety checks exist to prevent many unintended quota changes, but at the time they did not cover the scenario of zero reported load for a single service:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eQuota changes to large number of users, since only a single group was the target of the change,\u003c/li\u003e\n\u003cli\u003eLowering quota below usage, since the reported usage was inaccurately being reported as zero,\u003c/li\u003e\n\u003cli\u003eExcessive quota reduction to storage systems, since no alert fired during the grace period,\u003c/li\u003e\n\u003cli\u003eLow quota, since the difference between usage and quota exceeded the protection limit.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAs a result, the quota for the account database was reduced, which prevented the \u003ca href=\"(https://en.wikipedia.org/wiki/Paxos_(computer_science))\"\u003ePaxos leader\u003c/a\u003e from writing. Shortly after, the majority of read operations became outdated which resulted in errors on authentication lookups.\u003c/p\u003e\n\u003ch3\u003eRemediation \u0026#x26; Prevention\u003c/h3\u003e\n\u003cp\u003eOnce the root cause and potential fix were identified, engineers disabled the quota enforcement in one data canter. This quickly improved the situation and later the same mitigation was applied to all data-centres. As per the official statement they’ll be taking necessary actions to guard against the issue recurring and to reduce the impact of similar events.\u003c/p\u003e\n\u003ch3\u003eImpact on business\u003c/h3\u003e\n\u003cp\u003eAlmost all google services were impacted by this outage. Most services recovered automatically within a short period of time after the main issue ended, but some services like Cloud Console, Google BigQuery and  K8s Engine had unique and lingering impact.\u003c/p\u003e\n\u003ch2\u003eReferences:\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003ehttps://static.googleusercontent.com/media/www.google.com/en//appsstatus/ir/4et50yp2ckm8otv.pdf\u003c/li\u003e\n\u003cli\u003ehttps://status.cloud.google.com/incident/zall/20013\u003c/li\u003e\n\u003c/ol\u003e\n"},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"understanding-google-outages"},"buildId":"e0fszqdCnSRQTw8Y4iqrX","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>