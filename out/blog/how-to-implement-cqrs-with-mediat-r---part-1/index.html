<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width, shrink-to-fit=no, user-scalable=1, viewport-fit=cover"/><title>How to implement CQRS with MediatR - Part 1 | Krishna Mohan A M</title><meta name="title" content="How to implement CQRS with MediatR - Part 1"/><meta name="description" content="This post is about implementing mediator pattern in a dotnet console application using MediatR library."/><meta name="og:type" content="article"/><meta name="og:url" content="/blog/how-to-implement-cqrs-with-mediat-r---part-1"/><meta name="og:title" content="How to implement CQRS with MediatR - Part 1"/><meta name="og:description" content="This post is about implementing mediator pattern in a dotnet console application using MediatR library."/><meta name="og:image" content="https://krishnamohan.dev/banners/16.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:url" content="/blog/how-to-implement-cqrs-with-mediat-r---part-1"/><meta name="twitter:title" content="How to implement CQRS with MediatR - Part 1"/><meta name="twitter:description" content="This post is about implementing mediator pattern in a dotnet console application using MediatR library."/><meta name="twitter:image" content="https://krishnamohan.dev/banners/16.png"/><meta name="twitter:site" content="@krishnaanaril"/><meta name="twitter:creator" content="@krishnaanaril"/><meta name="keywords" content="dotnet, mediatr, cqrs"/><meta name="og:article:published_time" content="2021-02-26T00:00:00.000Z"/><meta name="og:article:modified_time" content="2021-02-26T00:00:00.000Z"/><meta name="og:article:author" content="Krishna Mohan A M"/><meta name="og:article:section" content="tech"/><meta name="og:article:tag" content="dotnet, mediatr, cqrs"/><meta name="next-head-count" content="23"/><link href="https://unpkg.com/prism-themes@1.6.0/themes/prism-shades-of-purple.css" rel="stylesheet"/><link rel="preload" href="/_next/static/css/4c58d0963c75419a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4c58d0963c75419a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-3653f441c4a2aa8a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e1cb0d25eaeaa056.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bid%5D-911bf6dd096ab7ef.js" defer=""></script><script src="/_next/static/Hi7_ijWCockvj5_zSwjlg/_buildManifest.js" defer=""></script><script src="/_next/static/Hi7_ijWCockvj5_zSwjlg/_ssgManifest.js" defer=""></script></head><body class="bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50 px-5 lg:px-0"><div id="__next"><div><nav class="sticky top-0 bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50 bg-opacity-50 dark:bg-opacity-50 backdrop-blur-lg"><section class="hidden lg:flex flex-row justify-center"><nav><ul class="lg:text-xl lg:flex lg:flex-row"><li class=""><a class="block p-4 cursor-pointer" href="/">Home</a></li><li class="border-b-2 border-gray-700 dark:border-gray-300"><a class="block p-4 cursor-pointer" href="/blogs/">Blog</a></li><li class=""><a class="block p-4 cursor-pointer" href="/projects/">Projects</a></li><li class=""><a class="block p-4 cursor-pointer" href="/about/">About</a></li></ul></nav></section><div class="lg:hidden mr-4 py-4 right-0"><button class="p-2" aria-label="view menu items"><svg class="fill-gray-800 dark:fill-gray-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black" width="24px" height="24px"><path d="M0 0h24v24H0z" fill="none"></path><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button></div></nav><div style="display:none" class="fixed top-0 left-0 bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50 bg-opacity-50 dark:bg-opacity-50 backdrop-blur-lg block h-screen lg:hidden p-2 w-screen z-1"><div class="bg-gray-100 bg-opacity-100 m-5 p-5 rounded-lg shadow-xl dark:bg-gray-600 dark:text-gray-50"><div class="flex flex-row justify-end"><button class="dark:text-gray-50" aria-label="close menu items"><svg class="fill-current" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button></div><ul class="list-none"><li class=""><a class="block p-4 cursor-pointer" href="/">Home</a></li><li class="border-b-2 border-gray-700 dark:border-gray-300"><a class="block p-4 cursor-pointer" href="/blogs/">Blog</a></li><li class=""><a class="block p-4 cursor-pointer" href="/projects/">Projects</a></li><li class=""><a class="block p-4 cursor-pointer" href="/about/">About</a></li></ul></div></div><div class="min-h-screen"><article class="bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50"><div><div aria-label="Blog tags/keywords" class="pt-8 flex flex-row justify-center"><a class="bg-gray-300 dark:bg-gray-700 border border-gray-400 ml-2 mr-2 pb-2 pl-4 pr-4 pt-2 text-sm align-baseline rounded-full" href="/blogs/tag/dotnet/">dotnet</a><a class="bg-gray-300 dark:bg-gray-700 border border-gray-400 ml-2 mr-2 pb-2 pl-4 pr-4 pt-2 text-sm align-baseline rounded-full" href="/blogs/tag/mediatr/">mediatr</a><a class="bg-gray-300 dark:bg-gray-700 border border-gray-400 ml-2 mr-2 pb-2 pl-4 pr-4 pt-2 text-sm align-baseline rounded-full" href="/blogs/tag/cqrs/">cqrs</a></div><div class="max-w-screen-lg mx-auto"><h1 class="text-5xl font-bold pt-5 pb-5 text-center">How to implement CQRS with MediatR - Part 1</h1></div><div class="flex flex-row justify-center m-5 max-w-screen-sm mx-auto"><time class="text-center text-xl">26 February 2021</time></div></div><div class="prose dark:prose-invert lg:prose-xl md:prose-lg max-w-screen-md mx-auto"><p>I came to know about <a href="https://github.com/jbogard/MediatR">MediatR</a> library while reading the book <a href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/">.NET Microservices: Architecture for Containerized .NET Applications</a>. Frankly speaking, even though I was aware of <a href="https://github.com/krishnaanaril/try-outs/blob/master/design-patterns/behavioral/mediator.ts">mediator pattern</a>, I haven't used it any of the projects I've worked. May be this is due to the fact that, I've mostly worked in enterprise applications with hardly 100+ users. Any way I consider this as an opportunity to learn a new thing.</p>
<p>In this post we'll be using MediatR with a dotnet console application. If you want to read about its implementation in a WebAPI, check out my other blog <a href="https://krishnamohan.dev/blog/how-to-implement-cqrs-with-mediat-r---part-2">post</a>.</p>
<h2>Prerequisites</h2>
<ul>
<li>Install <a href="https://dotnet.microsoft.com/download">dotnet core</a></li>
<li>Install Visual Studio Code/Visual Studio IDE</li>
</ul>
<h2>Creating a dotnet console application</h2>
<p>Okay, As the first step we need a console application. We can do so by running our dotnet <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-new">cli command</a>.</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">dotnet new console MediatRSample
</code></pre></div>
<h2>Configure Serilog for logging (Optional)</h2>
<p>I'll be using <a href="https://serilog.net/">Serilog</a> and a flat file sink for logging. To configure this we need to install the following dependencies via Nuget.</p>
<ul>
<li>Microsoft.Extensions.Logging</li>
<li>Serilog</li>
<li>Serilog.Sinks.File</li>
</ul>
<p>Then update the <code>Program.cs</code> file.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> services <span class="token operator">=</span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> serviceProvider <span class="token operator">=</span> services<span class="token punctuation">.</span><span class="token function">BuildServiceProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">IServiceCollection</span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">IServiceCollection</span> services <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ServiceCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> serilogLogger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LoggerConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span>Enrich<span class="token punctuation">.</span><span class="token function">FromLogContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span>WriteTo<span class="token punctuation">.</span><span class="token function">File</span><span class="token punctuation">(</span><span class="token string">"logs/MediatRSample.txt"</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">rollingInterval</span><span class="token punctuation">:</span> RollingInterval<span class="token punctuation">.</span>Day<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">CreateLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    services<span class="token punctuation">.</span><span class="token function">AddLogging</span><span class="token punctuation">(</span>builder <span class="token operator">=></span>
    <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">AddSerilog</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">logger</span><span class="token punctuation">:</span> serilogLogger<span class="token punctuation">,</span> <span class="token named-parameter punctuation">dispose</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        
    <span class="token keyword">return</span> services<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2>Install and Configure MediatR</h2>
<p>Next we need to install MediatR (version 9.0.0 at the time of writing) via Nuget. To configure MediatR, add the following snippet to the <code>ConfigureServices()</code> method.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp">services<span class="token punctuation">.</span><span class="token function">AddMediatR</span><span class="token punctuation">(</span>Assembly<span class="token punctuation">.</span><span class="token function">GetExecutingAssembly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h2>Create a Notification message and its handler</h2>
<p>Among the two message types provided by MediatR, here we are configuring notification messages.</p>
<h3>Create a bare minimum DTO (Data Transfer Object)</h3>
<p>This class implements <code>INotification</code>, a marker interface to represent a notification.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotificationMessage</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">INotification</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Message <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3>Create multiple handlers</h3>
<p>As notification messages can be handled by multiple handlers, we'll be creating two handlers.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Notifier01</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">INotificationHandler<span class="token punctuation">&#x3C;</span>NotificationMessage<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">Handle</span><span class="token punctuation">(</span><span class="token class-name">NotificationMessage</span> notification<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Notifier 01 -> Message: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">notification<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Notifier02</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">INotificationHandler<span class="token punctuation">&#x3C;</span>NotificationMessage<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">Handle</span><span class="token punctuation">(</span><span class="token class-name">NotificationMessage</span> notification<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Notifier 02 -> Message: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">notification<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2>Create a Request/Response message and its handler</h2>
<p>This message type supports both one way and two way communication, but can only be received by a single handler. If you have defined multiple handlers only the first one will receive the message.</p>
<h3>Create a request message DTO</h3>
<p>Response message class implement <code>IRequest</code>, a marker interface to represent a request.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token comment">// We need to mention response type in two way</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Ping</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IRequest<span class="token punctuation">&#x3C;</span><span class="token keyword">string</span><span class="token punctuation">></span></span></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> 

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OneWaySync</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IRequest</span></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div>
<h3>Create handlers</h3>
<p>For a two way handler we define a class that implements <code>IRequestHandler</code>, otherwise for async request use <code>AsyncRequestHandler</code> and for sync request <code>RequestHandler</code> base classes.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PingHandler</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IRequestHandler<span class="token punctuation">&#x3C;</span>Ping<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Task<span class="token punctuation">&#x3C;</span><span class="token keyword">string</span><span class="token punctuation">></span></span> <span class="token function">Handle</span><span class="token punctuation">(</span><span class="token class-name">Ping</span> request<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span><span class="token string">"Pong"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OneWayAsyncHandler</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AsyncRequestHandler<span class="token punctuation">&#x3C;</span>OneWayAsync<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">Handle</span><span class="token punctuation">(</span><span class="token class-name">OneWayAsync</span> request<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"In Async One Way Handler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OneWaySyncHandler</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RequestHandler<span class="token punctuation">&#x3C;</span>OneWaySync<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Handle</span><span class="token punctuation">(</span><span class="token class-name">OneWaySync</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"In Sync One Way Handler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2>Create a mediator service</h2>
<p>Mediator service publishes messages to the handlers. This class contains the <code>IMediator</code> object that is inject via DI and contains the knowledge of all the message types and its corresponding handlers.</p>
<h3>Create <code>IMediatorService</code> interface</h3>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMediatorService</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Notify</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> notifyText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">RequestResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OneWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3>Create MediatorService Class</h3>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MediatorService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IMediatorService</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IMediator</span> _mediator<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">MediatorService</span><span class="token punctuation">(</span><span class="token class-name">IMediator</span> mediator<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _mediator <span class="token operator">=</span> mediator<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Notify</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> notifyText<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _mediator<span class="token punctuation">.</span><span class="token function">Publish</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">NotificationMessage</span> <span class="token punctuation">{</span> Message <span class="token operator">=</span> notifyText <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">RequestResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">string</span></span> response <span class="token operator">=</span> Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>
            <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">await</span> _mediator<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">.</span>Result<span class="token punctuation">;</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OneWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">await</span> _mediator<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">OneWayAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _mediator<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">OneWaySync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>        
<span class="token punctuation">}</span>
</code></pre></div>
<h3>Add MediatorService to DI configuration</h3>
<p>Add the following statement in <code>ConfigureServices()</code> method of <code>Program.cs</code></p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp">services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddTransient</span><span class="token generic class-name"><span class="token punctuation">&#x3C;</span>IMediatorService<span class="token punctuation">,</span> MediatorService<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h2>Run the application</h2>
<p>Finally we need to issue commands/requests to these created handlers. For that we can create the following methods in the source class.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IMediatorService</span> _notifierMediatorService<span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    _notifierMediatorService<span class="token punctuation">.</span><span class="token function">Notify</span><span class="token punctuation">(</span><span class="token string">"Test Message"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RequestResonse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> response <span class="token operator">=</span> _notifierMediatorService<span class="token punctuation">.</span><span class="token function">RequestResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"In App: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">response</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OneWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    _notifierMediatorService<span class="token punctuation">.</span><span class="token function">OneWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>To run the project via dotnet cli, run the following command.</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">dotnet run <span class="token parameter variable">--project</span> <span class="token operator">&#x3C;</span>Path to *.csproj file<span class="token operator">></span>
</code></pre></div>
<p>You'll get a similar output as below:</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">Notifier 01 -<span class="token operator">></span> Message: Test Message
Notifier 02 -<span class="token operator">></span> Message: Test Message
In App: Pong
In Sync One Way Handler
In Async One Way Handler
</code></pre></div>
<h2>Final Thoughts</h2>
<p>Among other things, one of the problem MediatR is trying to solve is <a href="https://stackoverflow.com/questions/2420193/how-to-avoid-dependency-injection-constructor-madness">DI Constructor Explosion</a> which is a highly debated topic. Also by using MediatR everything is done in-process, request initiator and handler runs in the same process which may be cumbersome in some scenarios. If you want event/notification to be completely independent, try <a href="https://www.goparamore.io/">MassTransit</a> or <a href="https://www.goparamore.io/">Brighter</a>.</p>
<p>If you're interested to view the full solution, it is available in <a href="https://github.com/krishnaanaril/try-outs/tree/master/MediatRSample/MediatRSample">GitHub</a>.</p>
</div></article></div><footer class="flex flex-col bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50"><div class="mt-10"><ul class="flex flex-row justify-between max-w-sm mx-auto pl-4 pr-4"><li class="hover:text-gray-600 dark:hover:text-gray-100"><a href="https://twitter.com/KrishnaAnaril">Twitter</a></li><li><a href="https://krishnamohan.dev/sitemap.xml">Sitemap</a></li><li><a href="https://krishnamohan.dev/rss.xml">RSS</a></li><li><a href="mailto:krishnamohan.a.m@gmail.com">Contact</a></li></ul></div><div class="mx-auto p-5 text-sm"><p>Â© 2021-present <a class="font-bold" href="https://krishnamohan.dev/">Krishna Mohan A M</a>. All Rights Reserved.</p></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"how-to-implement-cqrs-with-mediat-r---part-1","meta":{"title":"How to implement CQRS with MediatR - Part 1","description":"This post is about implementing mediator pattern in a dotnet console application using MediatR library.","published":true,"publishedAt":"2021-02-26T00:00:00.000Z","updatedAt":"2021-02-26T00:00:00.000Z","category":"tech","image":"banners/16","keywords":["dotnet","mediatr","cqrs"],"authors":["Krishna Mohan A M"]},"content":"\u003cp\u003eI came to know about \u003ca href=\"https://github.com/jbogard/MediatR\"\u003eMediatR\u003c/a\u003e library while reading the book \u003ca href=\"https://docs.microsoft.com/en-us/dotnet/architecture/microservices/\"\u003e.NET Microservices: Architecture for Containerized .NET Applications\u003c/a\u003e. Frankly speaking, even though I was aware of \u003ca href=\"https://github.com/krishnaanaril/try-outs/blob/master/design-patterns/behavioral/mediator.ts\"\u003emediator pattern\u003c/a\u003e, I haven't used it any of the projects I've worked. May be this is due to the fact that, I've mostly worked in enterprise applications with hardly 100+ users. Any way I consider this as an opportunity to learn a new thing.\u003c/p\u003e\n\u003cp\u003eIn this post we'll be using MediatR with a dotnet console application. If you want to read about its implementation in a WebAPI, check out my other blog \u003ca href=\"https://krishnamohan.dev/blog/how-to-implement-cqrs-with-mediat-r---part-2\"\u003epost\u003c/a\u003e.\u003c/p\u003e\n\u003ch2\u003ePrerequisites\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eInstall \u003ca href=\"https://dotnet.microsoft.com/download\"\u003edotnet core\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eInstall Visual Studio Code/Visual Studio IDE\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eCreating a dotnet console application\u003c/h2\u003e\n\u003cp\u003eOkay, As the first step we need a console application. We can do so by running our dotnet \u003ca href=\"https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-new\"\u003ecli command\u003c/a\u003e.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003edotnet new console MediatRSample\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eConfigure Serilog for logging (Optional)\u003c/h2\u003e\n\u003cp\u003eI'll be using \u003ca href=\"https://serilog.net/\"\u003eSerilog\u003c/a\u003e and a flat file sink for logging. To configure this we need to install the following dependencies via Nuget.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMicrosoft.Extensions.Logging\u003c/li\u003e\n\u003cli\u003eSerilog\u003c/li\u003e\n\u003cli\u003eSerilog.Sinks.File\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThen update the \u003ccode\u003eProgram.cs\u003c/code\u003e file.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eMain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003c/span\u003e args\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003c/span\u003e services \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eConfigureServices\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003c/span\u003e serviceProvider \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e services\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eBuildServiceProvider\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e        \n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eIServiceCollection\u003c/span\u003e \u003cspan class=\"token function\"\u003eConfigureServices\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003eIServiceCollection\u003c/span\u003e services \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eServiceCollection\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003c/span\u003e serilogLogger \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eLoggerConfiguration\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eEnrich\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eFromLogContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eWriteTo\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eFile\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"logs/MediatRSample.txt\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token named-parameter punctuation\"\u003erollingInterval\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e RollingInterval\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDay\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eCreateLogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    services\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eAddLogging\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebuilder \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        builder\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eAddSerilog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token named-parameter punctuation\"\u003elogger\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e serilogLogger\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token named-parameter punctuation\"\u003edispose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e                        \n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e services\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eInstall and Configure MediatR\u003c/h2\u003e\n\u003cp\u003eNext we need to install MediatR (version 9.0.0 at the time of writing) via Nuget. To configure MediatR, add the following snippet to the \u003ccode\u003eConfigureServices()\u003c/code\u003e method.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003eservices\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eAddMediatR\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eAssembly\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetExecutingAssembly\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eCreate a Notification message and its handler\u003c/h2\u003e\n\u003cp\u003eAmong the two message types provided by MediatR, here we are configuring notification messages.\u003c/p\u003e\n\u003ch3\u003eCreate a bare minimum DTO (Data Transfer Object)\u003c/h3\u003e\n\u003cp\u003eThis class implements \u003ccode\u003eINotification\u003c/code\u003e, a marker interface to represent a notification.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eNotificationMessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eINotification\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e Message \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003eCreate multiple handlers\u003c/h3\u003e\n\u003cp\u003eAs notification messages can be handled by multiple handlers, we'll be creating two handlers.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eNotifier01\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eINotificationHandler\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eNotificationMessage\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eTask\u003c/span\u003e \u003cspan class=\"token function\"\u003eHandle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eNotificationMessage\u003c/span\u003e notification\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCancellationToken\u003c/span\u003e cancellationToken\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        Console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token interpolation-string\"\u003e\u003cspan class=\"token string\"\u003e$\"Notifier 01 -\u003e Message: \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token expression language-csharp\"\u003enotification\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e Task\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCompletedTask\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eNotifier02\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eINotificationHandler\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eNotificationMessage\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eTask\u003c/span\u003e \u003cspan class=\"token function\"\u003eHandle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eNotificationMessage\u003c/span\u003e notification\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCancellationToken\u003c/span\u003e cancellationToken\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        Console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token interpolation-string\"\u003e\u003cspan class=\"token string\"\u003e$\"Notifier 02 -\u003e Message: \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token expression language-csharp\"\u003enotification\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e Task\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCompletedTask\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eCreate a Request/Response message and its handler\u003c/h2\u003e\n\u003cp\u003eThis message type supports both one way and two way communication, but can only be received by a single handler. If you have defined multiple handlers only the first one will receive the message.\u003c/p\u003e\n\u003ch3\u003eCreate a request message DTO\u003c/h3\u003e\n\u003cp\u003eResponse message class implement \u003ccode\u003eIRequest\u003c/code\u003e, a marker interface to represent a request.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token comment\"\u003e// We need to mention response type in two way\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ePing\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIRequest\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eOneWaySync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIRequest\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003eCreate handlers\u003c/h3\u003e\n\u003cp\u003eFor a two way handler we define a class that implements \u003ccode\u003eIRequestHandler\u003c/code\u003e, otherwise for async request use \u003ccode\u003eAsyncRequestHandler\u003c/code\u003e and for sync request \u003ccode\u003eRequestHandler\u003c/code\u003e base classes.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ePingHandler\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIRequestHandler\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ePing\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eTask\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eHandle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003ePing\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCancellationToken\u003c/span\u003e cancellationToken\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e Task\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eFromResult\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Pong\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eOneWayAsyncHandler\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eAsyncRequestHandler\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eOneWayAsync\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eoverride\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eTask\u003c/span\u003e \u003cspan class=\"token function\"\u003eHandle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eOneWayAsync\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCancellationToken\u003c/span\u003e cancellationToken\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        Console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"In Async One Way Handler\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e Task\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCompletedTask\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eOneWaySyncHandler\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eRequestHandler\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eOneWaySync\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eoverride\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eHandle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eOneWaySync\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        Console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"In Sync One Way Handler\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e            \n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eCreate a mediator service\u003c/h2\u003e\n\u003cp\u003eMediator service publishes messages to the handlers. This class contains the \u003ccode\u003eIMediator\u003c/code\u003e object that is inject via DI and contains the knowledge of all the message types and its corresponding handlers.\u003c/p\u003e\n\u003ch3\u003eCreate \u003ccode\u003eIMediatorService\u003c/code\u003e interface\u003c/h3\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIMediatorService\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eNotify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e notifyText\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eRequestResponse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eOneWay\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003eCreate MediatorService Class\u003c/h3\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMediatorService\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIMediatorService\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIMediator\u003c/span\u003e _mediator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token function\"\u003eMediatorService\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eIMediator\u003c/span\u003e mediator\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _mediator \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e mediator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eNotify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e notifyText\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _mediator\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePublish\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eNotificationMessage\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e Message \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e notifyText \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eRequestResponse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e response \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Task\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eRun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e _mediator\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eSend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003ePing\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eResult\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e response\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eOneWay\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        Task\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eRun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e _mediator\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eSend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eOneWayAsync\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _mediator\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eSend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eOneWaySync\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e        \n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003eAdd MediatorService to DI configuration\u003c/h3\u003e\n\u003cp\u003eAdd the following statement in \u003ccode\u003eConfigureServices()\u003c/code\u003e method of \u003ccode\u003eProgram.cs\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003eservices\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token generic-method\"\u003e\u003cspan class=\"token function\"\u003eAddTransient\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eIMediatorService\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e MediatorService\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eRun the application\u003c/h2\u003e\n\u003cp\u003eFinally we need to issue commands/requests to these created handlers. For that we can create the following methods in the source class.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIMediatorService\u003c/span\u003e _notifierMediatorService\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// ...\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eNotify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    _notifierMediatorService\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eNotify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Test Message\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eRequestResonse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003estring\u003c/span\u003e\u003c/span\u003e response \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e _notifierMediatorService\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eRequestResponse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    Console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token interpolation-string\"\u003e\u003cspan class=\"token string\"\u003e$\"In App: \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token expression language-csharp\"\u003eresponse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eOneWay\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    _notifierMediatorService\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eOneWay\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTo run the project via dotnet cli, run the following command.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003edotnet run \u003cspan class=\"token parameter variable\"\u003e--project\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003ePath to *.csproj file\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou'll get a similar output as below:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003eNotifier 01 -\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e Message: Test Message\nNotifier 02 -\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e Message: Test Message\nIn App: Pong\nIn Sync One Way Handler\nIn Async One Way Handler\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eFinal Thoughts\u003c/h2\u003e\n\u003cp\u003eAmong other things, one of the problem MediatR is trying to solve is \u003ca href=\"https://stackoverflow.com/questions/2420193/how-to-avoid-dependency-injection-constructor-madness\"\u003eDI Constructor Explosion\u003c/a\u003e which is a highly debated topic. Also by using MediatR everything is done in-process, request initiator and handler runs in the same process which may be cumbersome in some scenarios. If you want event/notification to be completely independent, try \u003ca href=\"https://www.goparamore.io/\"\u003eMassTransit\u003c/a\u003e or \u003ca href=\"https://www.goparamore.io/\"\u003eBrighter\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eIf you're interested to view the full solution, it is available in \u003ca href=\"https://github.com/krishnaanaril/try-outs/tree/master/MediatRSample/MediatRSample\"\u003eGitHub\u003c/a\u003e.\u003c/p\u003e\n"},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"how-to-implement-cqrs-with-mediat-r---part-1"},"buildId":"Hi7_ijWCockvj5_zSwjlg","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>