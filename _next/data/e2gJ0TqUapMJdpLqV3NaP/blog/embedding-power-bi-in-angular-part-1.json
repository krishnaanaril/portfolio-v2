{"pageProps":{"id":"embedding-power-bi-in-angular-part-1","meta":{"title":"Embedding Power BI in Angular — Part 1","description":"Power BI is a powerful tool which helps us to create quick and interactive insights from wide range of data sources. Here we’ll be discussing about Power BI service which is a SaaS, and how to embed Power BI Dashboards, Reports and Tiles in web applications.","published":true,"publishedAt":"2018-10-15T00:00:00.000Z","updatedAt":"2018-10-15T00:00:00.000Z","category":"tech","image":"banners/01","keywords":["powerbi","angular","dotnet"],"authors":["Krishna Mohan A M"]},"content":"<p>Power BI is a powerful tool which helps us to create quick and interactive insights from wide range of data sources. Here we’ll be discussing about <strong>Power BI service</strong> which is a <strong>SaaS</strong>, and how to embed Power BI Dashboards, Reports and Tiles in web applications. If you are new to Power BI, you can start <a href=\"https://docs.microsoft.com/en-us/power-bi/power-bi-overview\">here</a>.</p>\n<p>Power BI can be embedded in an application by two ways:</p>\n<ol>\n<li>\n<p><strong>Embedding for customers</strong> — This is for embedding dashboards and reports to user who don’t have Power BI account. Power BI API’s are invoked based on the application’s master account and the reports/dashboards are made available to the users of the application.</p>\n</li>\n<li>\n<p><strong>Embedding for your organization</strong> — This is for embedding dashboards/reports for the users in your organization, who have Power BI accounts.</p>\n</li>\n</ol>\n<blockquote>\n<p><strong>Update on 30th January 2019:</strong> There is a new option that enables business users who do not have any coding skills to easily and securely embed reports in internal web portals. Users viewing the embedded report need either a Power BI Pro license or the content needs to be in a workspace that’s in a <a href=\"https://docs.microsoft.com/en-us/power-bi/service-admin-premium-purchase\">Power BI Premium capacity (EM or P SKU)</a>. More information is available <a href=\"https://powerbi.microsoft.com/en-us/blog/easily-embed-secure-power-bi-reports-in-your-internal-portals-or-websites\">here</a>.</p>\n</blockquote>\n<p>Microsoft provides sample .net applications for both ways. The source code is available <a href=\"https://github.com/Microsoft/PowerBI-Developer-Samples\">here</a>, well and good. But how to embed reports/dashboards in popular JavaScript frameworks?</p>\n<p>There weren’t much tutorials available on-line, and I was bit confused with the distinction between the above two approaches. But I was not alone in this pursuit, <a href=\"https://medium.com/@ramandeep.singh.1983/power-bi-overview-and-angular-embedding-how-to-f73390f4a399\">someone</a> have already figured out the “Embedding for customers” and it was really helpful. I wasn’t satisfied with that and after spending a couple of days in Power BI forums and GitHub repositories, I’ve finally figured out how to do it both.</p>\n<p>This is the first part of the two-part article series. You can find the second one <a href=\"https://krishnamohan.dev/blog/embedding-powerbi-in-angular-part-2\">here</a>.</p>\n<h2>Embedding for Customers</h2>\n<p>Creating dashboards/reports using Power BI are out of scope of this article, you can learn more about it <a href=\"https://docs.microsoft.com/en-us/power-bi/service-get-started\">here</a>. I’ve skipped a lot a details which have better documentation elsewhere.</p>\n<h3>Contents</h3>\n<ul>\n<li>Prerequisite</li>\n<li>Overview</li>\n<li>Set up your embedded analytics development environment</li>\n<li>Set up your Power BI environment</li>\n<li>Create a Web API</li>\n<li>Create Angular client</li>\n<li>Conclusion</li>\n</ul>\n<h3>Prerequisites</h3>\n<ul>\n<li><a href=\"https://powerbi.microsoft.com/en-us/pricing/\">Power BI pro account</a></li>\n<li><a href=\"https://azure.microsoft.com/en-us/free/\">Microsoft Azure Subscription</a></li>\n<li><a href=\"https://docs.microsoft.com/en-us/power-bi/developer/create-an-azure-active-directory-tenant\">Azure Active Directory Tenant</a> Setup. If it is already done for your organization, you can find it <a href=\"https://www.whatismytenantid.com/\">here</a>.</li>\n<li>Visual Studio (2013 or later)</li>\n<li>Visual Studio Code</li>\n<li>npm, node, angular-cli</li>\n</ul>\n<h3>Overview</h3>\n<p>A high level diagram showing how this works is shown below.</p>\n<p><img src=\"/images/01_01.png\" alt=\"Embedding for customers\">\r\n<em>Embedding for customers</em></p>\n<p>The work flow is as follows.</p>\n<ol>\n<li>When user browse UI, it invokes API for embed token.</li>\n<li>API authenticates application using master account credentials and request for tokens.</li>\n<li>Azure AD returns token on successful validation, else reject the request.</li>\n<li>Embed token is returned to UI from API.</li>\n<li>UI calls Power BI API to get the report specific data with the token.</li>\n<li>Power BI API returns report data, and UI displays it in the web page.</li>\n<li>(Optional) User authorization via custom roles stored in the SQL server (or by any other means).</li>\n</ol>\n<h3>Set up your embedded analytics development environment</h3>\n<p>Refer <a href=\"https://docs.microsoft.com/en-us/power-bi/developer/embed-sample-for-customers#set-up-your-embedded-analytics-development-environment\">this</a> for more details.</p>\n<blockquote>\n<p>Since we are using Web API, redirect URL don’t have much significance.</p>\n</blockquote>\n<h3>Set up your Power BI environment</h3>\n<p>Refer <a href=\"https://docs.microsoft.com/en-us/power-bi/developer/embed-sample-for-customers#set-up-your-power-bi-environment\">this</a> for more details.</p>\n<h3>Create a Web API</h3>\n<p>If you are new to Web API’s, you can start <a href=\"https://docs.microsoft.com/en-us/aspnet/web-api/overview/getting-started-with-aspnet-web-api/tutorial-your-first-web-api\">here</a>. In the Web.config file we need to add few key-value pairs. Here you need to provide your master account’s username and password.</p>\n<p><img src=\"/images/01_02.png\" alt=\"\"><em>Gist: https://gist.github.com/krishnaanaril/fdec1fe979dd353cd04bb86474e387e3</em></p>\n<p>You’ll get ‘applicationId’, ‘workspaceId’ and ‘reportId’ during Power BI setup. Now we need to define the token objects to be returned from the methods.</p>\n<p><img src=\"/images/01_03.png\" alt=\"\"><em>Token object for Dashboard/Reports. Gist: https://gist.github.com/krishnaanaril/5e56889f072a2606c1da0646766501dc</em></p>\n<p><img src=\"/images/01_04.png\" alt=\"\"><em>Token object for Tiles. Gist: https://gist.github.com/krishnaanaril/8d4960b06aeefa218886c959308974f6</em></p>\n<p>We need to add Microsoft Power BI client <a href=\"https://www.nuget.org/packages/Microsoft.PowerBI.Api/\">library</a> as we are invoking Power BI API’s from the server side code.</p>\n<p>As API methods, I’ve created three methods for Reports, Dashboards and Tiles respectively.</p>\n<ol>\n<li>\n<p><strong>GetReportEmbedToken</strong>— This method accepts two optional parameters, username and roles, which is used for enabling row-level security (RLS). You can find more info about RLS <a href=\"https://docs.microsoft.com/en-us/power-bi/service-admin-rls\">here</a>. In the method, we are returning the embed token for the first report available in the workspace.</p>\n</li>\n<li>\n<p><strong>GetDashboardEmbedToken</strong>— This method returns the embed token for the first dashboard in the workspace.</p>\n</li>\n<li>\n<p><strong>GetTileEmbedToken</strong>— This method returns the embed token for the first tile in the first dashboard which is available in the workspace.</p>\n</li>\n</ol>\n<p><img src=\"/images/01_05.png\" alt=\"\"><em>API method for getting embed token. Gist: https://gist.github.com/krishnaanaril/b093ab817d8fc29e4096346e034ccf3f</em></p>\n<p>You can extend this methods to return tokens for custom reports, dashboards and tiles.</p>\n<h3>Create Angular client</h3>\n<p>Here we need to create a service to call the API we created above. For that, let’s create a service and add the following method.</p>\n<p><img src=\"/images/01_06.png\" alt=\"\"><em>Gist: https://gist.github.com/krishnaanaril/2387fa2a7fb2746cf1b0d93c149f03a9</em></p>\n<p>In the HTML page, create a ‘div’ with id ‘embedReport’. We’ll be showing report in this div. Embedding in div is done using Power BI JavaScript <a href=\"https://github.com/Microsoft/PowerBI-JavaScript\">library</a>. You can add it to your angular application by running the following command.</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">--save</span> powerbi-client\n</code></pre></div>\n<p>Next, we need to create a method in component class to embed the reports as follows.</p>\n<p><img src=\"/images/01_07.png\" alt=\"\"><em>Gist: https://gist.github.com/krishnaanaril/412001afccf2f74d1c840e1f7fb4b7fe</em></p>\n<p>For embedding reports for customers, type should be ‘reports’ and token type should be ‘Embed’. Here you can see the code for ‘tokenExpirationListener’. This is added as the generated tokens are valid only for an hour and it expires after that. So we need to generate another token by that time and update it. More info can be found <a href=\"https://github.com/Microsoft/PowerBI-JavaScript/wiki/Refresh-token-using-JavaScript-SDK-example\">here</a>.</p>\n<h3>Conclusion</h3>\n<p>Now you’re done with your Angular app and its corresponding Web API, run it and verify the reports.</p>\n"},"__N_SSG":true}